<section class="py-16 relative overflow-hidden">
  <div class="absolute inset-0 bg-primary-900"></div>
  <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
  <div class="absolute top-0 right-0 w-[600px] h-[600px] bg-primary-500/20 rounded-full blur-3xl translate-x-1/2 -translate-y-1/2"></div>
  
  <div class="max-w-4xl mx-auto px-4 relative z-10 text-center">
    <h2 class="text-3xl md:text-5xl font-bold text-white mb-6">
      {{ .Params.cta.headline }}
    </h2>
    <p class="text-lg text-primary-100 mb-10 max-w-2xl mx-auto">
      {{ .Params.cta.subheadline }}
    </p>
    <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
      <form id="newsletter-form" class="flex flex-col sm:flex-row gap-2">
        <input
          id="newsletter-email"
          type="email"
          placeholder="Enter your email..."
          required
          class="bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-sm text-white placeholder-primary-200 focus:ring-2 focus:ring-white/50 outline-none"
        />
        <button type="submit" id="newsletter-btn" class="inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 bg-primary-600 text-white hover:bg-primary-700 shadow-lg shadow-primary-600/20 hover:shadow-primary-600/40 focus:ring-primary-500 px-10 py-3 text-md whitespace-nowrap">
          Subscribe
        </button>
      </form>
    </div>
    <p id="newsletter-msg" class="text-sm mt-3 hidden"></p>
    <script>
      document.getElementById('newsletter-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        const email = document.getElementById('newsletter-email').value;
        const btn = document.getElementById('newsletter-btn');
        const msg = document.getElementById('newsletter-msg');
        btn.disabled = true;
        btn.textContent = 'Subscribing...';
        msg.classList.add('hidden');
        try {
          const res = await fetch('https://connect.mailerlite.com/api/subscribers', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer {{ .Site.Params.mailerlite.apiKey }}'
            },
            body: JSON.stringify({
              email: email,
              groups: ['{{ .Site.Params.mailerlite.groupId }}']
            })
          });
          if (res.ok || res.status === 200 || res.status === 201) {
            msg.textContent = 'Thanks for subscribing!';
            msg.className = 'text-sm mt-3 text-green-400 text-center';
            document.getElementById('newsletter-email').value = '';
          } else {
            const data = await res.json();
            msg.textContent = data.message || 'Something went wrong. Please try again.';
            msg.className = 'text-sm mt-3 text-red-400 text-center';
          }
        } catch (err) {
          msg.textContent = 'Network error. Please try again.';
          msg.className = 'text-sm mt-3 text-red-400 text-center';
        }
        btn.disabled = false;
        btn.textContent = 'Subscribe';
      });
    </script>
  </div>
</section>
